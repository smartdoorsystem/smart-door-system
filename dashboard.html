<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Employee Dashboard ‚Äî Smart Door System</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1: #0f1724;
    --glass: rgba(255,255,255,0.04);
    --muted: #9aa6b2;
    --accentA: linear-gradient(135deg,#7b61ff,#2be7b7);
    --accentB: linear-gradient(135deg,#ff6b6b,#ffd86b);
  }
  *{box-sizing:border-box}
  body{
    margin:0;min-height:100vh;font-family:"Inter",system-ui,Segoe UI,Roboto,Arial;
    background: radial-gradient(1200px 600px at 10% 10%, rgba(43,231,183,0.05), transparent),
                radial-gradient(900px 500px at 90% 90%, rgba(123,97,255,0.05), transparent),
                var(--bg1);
    color:#e6eef8;padding:20px;
  }
  header{max-width:1300px;margin:0 auto 18px;display:flex;align-items:center;justify-content:space-between;gap:12px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:56px;height:56px;border-radius:12px;background:var(--accentA);display:flex;align-items:center;justify-content:center;font-weight:800;color:#041018}
  h1{font-size:18px;margin:0}
  .subtitle{color:var(--muted);font-size:13px}
  .controls{display:flex;gap:10px;align-items:center}
  .chip{padding:8px 12px;border-radius:999px;background:var(--glass);font-size:13px;color:var(--muted)}
  main{max-width:1300px;margin:0 auto;display:grid;grid-template-columns:1.1fr 420px;gap:20px;align-items:start}
  @media(max-width:1000px){ main{grid-template-columns:1fr} }

  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:14px;box-shadow:0 8px 30px rgba(6,10,20,0.6);border:1px solid rgba(255,255,255,0.03);transition:transform .18s,box-shadow .18s}
  .card:hover{transform:translateY(-6px);box-shadow:0 18px 50px rgba(2,6,20,0.7)}
  .card h2{margin:0 0 10px 0;font-size:15px}
  small.muted{color:var(--muted);display:block;margin-top:6px;font-size:12px}

  /* layout */
  .left-grid{display:grid;gap:20px}
  .three-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}
  .two-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:20px}
  @media(max-width:1100px){ .three-grid{grid-template-columns:repeat(1,1fr)} .two-grid{grid-template-columns:repeat(1,1fr)} }

  select,input,textarea,button{font-family:inherit}
  input,select,textarea{background:var(--glass);border:1px solid rgba(255,255,255,0.03);color:#eaf6f1;padding:10px;border-radius:10px;width:100%}
  button.btn{background:var(--accentA);border:none;color:#041018;padding:10px 12px;border-radius:10px;font-weight:700;cursor:pointer}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  .small-btn{padding:6px 8px;border-radius:8px;border:none;cursor:pointer;background:rgba(255,255,255,0.03);color:var(--muted)}

  ul{list-style:none;padding:0;margin:8px 0;max-height:280px;overflow:auto}
  .task-row{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.006));border:1px solid rgba(255,255,255,0.02);gap:12px}
  .task-left{display:flex;align-items:center;gap:12px}
  .muted-note{color:var(--muted);font-size:13px;margin-top:8px}

  /* calculator */
  .calc-display{height:46px;display:flex;align-items:center;padding:10px;border-radius:8px;font-weight:700;background:rgba(0,0,0,0.25);margin-bottom:8px}
  .calc-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
  .calc-key{padding:12px;border-radius:8px;border:none;background:rgba(255,255,255,0.02);cursor:pointer;font-weight:700}

  /* progress */
  .progress{height:10px;border-radius:999px;background:rgba(255,255,255,0.04);overflow:hidden;margin-top:8px}
  .progress > i{display:block;height:100%;background:linear-gradient(90deg,#2be7b7,#7b61ff);width:0%}

  footer{max-width:1300px;margin:20px auto 50px;color:var(--muted);text-align:center;font-size:13px}
  code{background:rgba(255,255,255,0.03);padding:2px 6px;border-radius:6px;color:#eaf6f1}
</style>
</head>
<body>

<header>
  <div class="brand">
    <div class="logo">SDS</div>
    <div>
      <h1>Employee Dashboard</h1>
      <div class="subtitle">Smart Door System ‚Äî Personal workspace</div>
    </div>
  </div>
  <div class="controls">
    <div class="chip" id="currentDate">--</div>
    <div class="chip" id="deviceChip">Detecting</div>
  </div>
</header>

<main>
  <!-- LEFT MAIN -->
  <section class="left-grid">

    <!-- TOP: music / tasks / weather -->
    <div class="three-grid">
      <!-- Music -->
      <div class="card">
        <h2>üéµ Music Player</h2>
        <div style="display:flex;gap:8px;align-items:center">
          <select id="songSelect">
            <!-- ÿπÿØŸÑ ÿßŸÑŸÖÿ≥ÿßÿ±ÿßÿ™ ÿ≠ÿ≥ÿ® repo ŸÖÿ™ÿßÿπŸÉ -->
            <option value="songs/ùòùùò™ùò≠ùò™ùò¢ùòÆ ùòìùò¢ùòØùò¶ - ùò±ùò¢ùò≥ùòµùò™ùò§ùò≠ùò¶ùò¥ ùòöùò≠ùò∞ùò∏ùò¶ùò•   ùòôùò¶ùò∑ùò¶ùò≥ùò£(MP3_128K).mp3">Song 1</option>
            <option value="https://raw.githubusercontent.com/smartdoorsystem/smart-door-system/main/songs/song2.mp3">Song 2</option>
            <option value="https://raw.githubusercontent.com/smartdoorsystem/smart-door-system/main/songs/song3.mp3">Song 3</option>
          </select>
          <button class="btn" id="playBtn">Play</button>
          <button class="ghost" id="stopBtn">Stop</button>
        </div>
        <audio id="player" controls preload="none" style="margin-top:12px;border-radius:8px">
          <source id="playerSource" src="" type="audio/mpeg">
          Your browser doesn't support audio.
        </audio>
        <small class="muted-note">Host MP3 files in <code>songs/</code> on your repo and adjust select values.</small>
      </div>

      <!-- Tasks -->
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h2>‚úÖ To-Do</h2>
            <small class="muted-note">Tasks persist after reload ‚Äî clear with the button below</small>
          </div>
          <div>
            <button class="small-btn" id="exportTasks">Export</button>
            <button class="small-btn" id="clearAllTasks">Clear All</button>
          </div>
        </div>

        <div style="display:flex;gap:8px;margin-top:12px">
          <input id="taskInput" placeholder="New task..." />
          <button class="btn" id="addTaskBtn">Add</button>
        </div>

        <ul id="tasksList" style="margin-top:12px"></ul>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="muted-note" id="tasksSummary">0 tasks</div>
          <div style="display:flex;gap:8px">
            <button class="small-btn" id="sortTasks">Sort</button>
            <button class="small-btn" id="clearCompleted">Clear Done</button>
          </div>
        </div>
      </div>

      <!-- Weather -->
      <div class="card">
        <h2>üå§Ô∏è Weather ‚Äî Tripoli, LY</h2>
        <div id="weatherBox">Loading weather...</div>
        <small class="muted-note">Powered by OpenWeatherMap ‚Äî API key embedded.</small>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button class="btn" id="refreshWeather">Refresh</button>
          <button class="ghost" id="clearWeatherCache">Clear Stored Weather</button>
        </div>
      </div>
    </div>

    <!-- SECOND ROW: calculator / salary / employment -->
    <div class="three-grid" style="grid-template-columns:1fr 1fr 1fr">
      <!-- Calculator -->
      <div class="card">
        <h2>üßÆ Calculator</h2>
        <div class="calc-display" id="calcDisplay">0</div>
        <div class="calc-grid" id="calcGrid"></div>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button class="btn" id="calcClear">C</button>
          <button class="ghost" id="calcEval">= Evaluate</button>
        </div>
      </div>

      <!-- Salary -->
      <div class="card">
        <h2>üí∞ Salary & Deductions</h2>
        <div style="display:grid;gap:8px">
          <input type="number" id="grossSalary" placeholder="Gross monthly salary" />
          <div style="display:flex;gap:8px">
            <input type="number" id="taxPercent" placeholder="Tax %"/>
            <input type="number" id="ssPercent" placeholder="Social sec %"/>
          </div>
          <div style="display:flex;gap:8px">
            <button class="btn" id="calcSalaryBtn">Calculate</button>
            <button class="ghost" id="saveProfile">Save Profile</button>
          </div>
        </div>
        <div id="salaryResult" style="margin-top:12px"></div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
          <div>Next payday:</div>
          <div id="nextPayday">--</div>
        </div>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="small-btn" id="clearSalary">Clear Salary Data</button>
        </div>
      </div>

      <!-- Employment -->
      <div class="card">
        <h2>üíº Employment</h2>
        <label>Job Title</label>
        <input id="jobTitle" placeholder="e.g. Production Operator" />
        <label style="margin-top:8px">Started on (YYYY-MM-DD)</label>
        <input id="startDate" placeholder="2025-08-01" />
        <div style="display:flex;gap:8px;margin-top:10px">
          <button class="btn" id="saveStart">Update</button>
          <button class="ghost" id="clearStart">Clear</button>
        </div>
        <div style="margin-top:12px">
          <div id="workDuration">You have worked: --</div>
          <div class="muted-note" id="daysSince"></div>
        </div>
      </div>
    </div>

    <!-- THIRD ROW: extras -->
    <div class="two-grid">
      <div class="card">
        <h2>üïí Clock</h2>
        <div style="font-weight:800;font-size:28px" id="timeNow">--:--:--</div>
        <div style="color:var(--muted);margin-top:6px" id="dateNow">--</div>
      </div>

      <div class="card">
        <h2>üìå Pinned Notes</h2>
        <textarea id="pinnedNotes" placeholder="Important notes..."></textarea>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn" id="saveNotes">Save Notes</button>
          <button class="ghost" id="clearNotes">Clear Notes</button>
        </div>
      </div>
    </div>

  </section>

  <!-- RIGHT SIDEBAR -->
  <aside style="display:flex;flex-direction:column;gap:20px">
    <div class="card">
      <h2>Device & Profile</h2>
      <div id="deviceInfo">Detecting...</div>
      <label style="margin-top:8px">Name</label>
      <input id="profileName" placeholder="Your name" />
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn" id="saveProfileBtn">Save</button>
        <button class="ghost" id="clearProfileBtn">Clear Profile</button>
      </div>
    </div>

    <div class="card">
      <h2>Pomodoro</h2>
      <div style="display:flex;align-items:center;gap:12px">
        <div style="font-weight:800;font-size:28px" id="timerDisplay">25:00</div>
        <div style="display:flex;flex-direction:column;gap:8px">
          <button class="btn" id="startTimer">Start</button>
          <button class="ghost" id="stopTimer">Stop</button>
        </div>
      </div>
      <small class="muted-note">Default 25m session.</small>
    </div>

    <div class="card">
      <h2>Productivity</h2>
      <div>Tasks total: <strong id="prodTotal">0</strong></div>
      <div>Tasks done: <strong id="prodDone">0</strong></div>
      <div class="progress"><i id="prodBar"></i></div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="small-btn" id="exportAll">Export All Data</button>
        <button class="small-btn" id="clearAll">Clear ALL Stored Data</button>
      </div>
    </div>
  </aside>
</main>

<footer>Dashboard ‚Äî copy into your GitHub Pages repo. Weather fixed to Tripoli, LY.</footer>

<script>
/* =================
   CONFIG (put your API key here)
   =================
   The OpenWeatherMap API key you gave:
*/
const OPENWEATHER_API_KEY = "073c92ad4345c3a4a1d9b10671e10b52";

/* =================
   LocalStorage keys
   ================= */
const LS = {
  tasks: 'sds_tasks_v2',
  profile: 'sds_profile_v2',
  notes: 'sds_notes_v2',
  salary: 'sds_salary_v2',
  weather: 'sds_weather_v2',
  settings: 'sds_settings_v2'
};

function saveLS(key, val){ localStorage.setItem(key, JSON.stringify(val)) }
function loadLS(key, fallback){ try{ const v = JSON.parse(localStorage.getItem(key)); return v ?? fallback }catch(e){ return fallback } }
function clearLS(key){ localStorage.removeItem(key) }

/* ===== header date & device ===== */
document.getElementById('currentDate').textContent = new Date().toLocaleString(undefined, {weekday:'short', year:'numeric', month:'short', day:'numeric'});
const ua = navigator.userAgent;
const platform = navigator.platform || 'Unknown';
document.getElementById('deviceInfo').innerHTML =
  `<div><strong>UA:</strong> ${ua.split(')')[0]})</div><div style="color:${'#9aa6b2'};margin-top:6px">${platform} ‚Ä¢ ${screen.width}√ó${screen.height}</div>`;
document.getElementById('deviceChip').textContent = /Android|iPhone|iPad|iPod/i.test(ua) ? 'Mobile' : (platform.includes('Win') ? 'Desktop' : 'Browser');

/* =================
   MUSIC PLAYER
   ================= */
const player = document.getElementById('player');
const playerSource = document.getElementById('playerSource');
const songSelect = document.getElementById('songSelect');
playerSource.src = songSelect.value;
player.load();
songSelect.addEventListener('change', ()=>{ playerSource.src = songSelect.value; player.load(); });
document.getElementById('playBtn').addEventListener('click', ()=>{ player.play().catch(()=>{}); });
document.getElementById('stopBtn').addEventListener('click', ()=>{ player.pause(); player.currentTime = 0; });

/* =================
   TASKS (persistent)
   ================= */
let tasks = loadLS(LS.tasks, []); // array of {id,title,done,created}
const tasksList = document.getElementById('tasksList');
const tasksSummary = document.getElementById('tasksSummary');

function renderTasks(){
  tasksList.innerHTML = '';
  if(tasks.length === 0){ tasksList.innerHTML = '<div class="muted-note">No tasks yet</div>'; updateProductivity(); return; }
  tasks.forEach(t=>{
    const li = document.createElement('li'); li.className='task-row';
    const left = document.createElement('div'); left.className='task-left';
    const cb = document.createElement('input'); cb.type='checkbox'; cb.checked = !!t.done;
    cb.addEventListener('change', ()=>{ t.done = cb.checked; saveTasks(); renderTasks(); });
    const txt = document.createElement('div'); txt.innerHTML = `<div style="font-weight:700">${escapeHtml(t.title)}</div><div style="font-size:12px;color:${'#9aa6b2'}">${new Date(t.created).toLocaleString()}</div>`;
    left.appendChild(cb); left.appendChild(txt);
    const actions = document.createElement('div');
    const del = document.createElement('button'); del.className='small-btn'; del.textContent='Delete';
    del.addEventListener('click', ()=>{ tasks = tasks.filter(x=>x.id!==t.id); saveTasks(); renderTasks(); });
    actions.appendChild(del);
    li.appendChild(left); li.appendChild(actions);
    tasksList.appendChild(li);
  });
  tasksSummary.textContent = `${tasks.length} task(s) ‚Ä¢ ${tasks.filter(t=>t.done).length} done`;
  updateProductivity();
}
function saveTasks(){ saveLS(LS.tasks, tasks) }
function addTask(title){
  const t = { id: Date.now().toString(36), title, done:false, created: new Date().toISOString() };
  tasks.unshift(t); saveTasks(); renderTasks();
}
document.getElementById('addTaskBtn').addEventListener('click', ()=>{ const v = document.getElementById('taskInput').value.trim(); if(!v) return; addTask(v); document.getElementById('taskInput').value=''; });
document.getElementById('taskInput').addEventListener('keydown', e=>{ if(e.key==='Enter') document.getElementById('addTaskBtn').click(); });
document.getElementById('clearCompleted').addEventListener('click', ()=>{ tasks = tasks.filter(t=>!t.done); saveTasks(); renderTasks(); });
document.getElementById('sortTasks').addEventListener('click', ()=>{ tasks.sort((a,b)=>b.created.localeCompare(a.created)); saveTasks(); renderTasks(); });
document.getElementById('exportTasks').addEventListener('click', ()=>{
  const data = JSON.stringify(tasks, null, 2);
  const blob = new Blob([data], {type:'application/json'}); const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'tasks.json'; a.click(); URL.revokeObjectURL(url);
});
document.getElementById('clearAllTasks').addEventListener('click', ()=>{ if(confirm('Clear ALL tasks?')){ tasks=[]; saveTasks(); renderTasks(); } });

renderTasks();

/* =================
   Productivity
   ================= */
function updateProductivity(){
  const total = tasks.length; const done = tasks.filter(t=>t.done).length;
  document.getElementById('prodTotal').textContent = total;
  document.getElementById('prodDone').textContent = done;
  const pct = total===0?0:Math.round(done/total*100);
  document.getElementById('prodBar').style.width = pct + '%';
}

/* =================
   WEATHER (Tripoli fixed)
   ================= */
const WEATHER_CACHE_TTL_MS = 15 * 60 * 1000; // cache 15 minutes
async function fetchTripoliWeather(force=false){
  const cached = loadLS(LS.weather, null);
  const now = Date.now();
  if(cached && !force && (now - (cached.ts||0) < WEATHER_CACHE_TTL_MS)){
    renderWeather(cached.data);
    return;
  }
  const q = 'Tripoli,LY';
  const url = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(q)}&units=metric&appid=${OPENWEATHER_API_KEY}&lang=en`;
  try{
    const res = await fetch(url);
    const data = await res.json();
    if(data?.cod && data.cod !== 200){ document.getElementById('weatherBox').textContent = 'Weather API error'; return; }
    saveLS(LS.weather, { ts: Date.now(), data }); renderWeather(data);
  }catch(e){
    console.error(e); document.getElementById('weatherBox').textContent = 'Network error fetching weather';
  }
}
function renderWeather(d){
  if(!d){ document.getElementById('weatherBox').textContent = 'No data'; return; }
  const html = `<div style="font-weight:700">${d.name} ‚Äî ${d.weather[0].main}</div>
    <div style="margin-top:6px">${d.weather[0].description} ‚Ä¢ ${Math.round(d.main.temp)}¬∞C (feels ${Math.round(d.main.feels_like)}¬∞C)</div>
    <div style="margin-top:6px;color:${'#9aa6b2'}">Humidity ${d.main.humidity}% ‚Ä¢ Wind ${d.wind.speed} m/s</div>`;
  document.getElementById('weatherBox').innerHTML = html;
}
document.getElementById('refreshWeather').addEventListener('click', ()=>fetchTripoliWeather(true));
document.getElementById('clearWeatherCache').addEventListener('click', ()=>{ clearLS(LS.weather); alert('Weather cache cleared'); fetchTripoliWeather(true); });

fetchTripoliWeather(false);

/* =================
   CALCULATOR (grid)
   ================= */
let calcExpr = '';
const calcDisplay = document.getElementById('calcDisplay');
const calcGrid = document.getElementById('calcGrid');
const keys = ['7','8','9','/','4','5','6','*','1','2','3','-','0','.','(',')','+','C','‚Üê','='];
keys.forEach(k=>{
  const b = document.createElement('button'); b.className='calc-key'; b.textContent = k;
  b.addEventListener('click', ()=>onCalcKey(k)); calcGrid.appendChild(b);
});
function onCalcKey(k){
  if(k==='C'){ calcExpr=''; renderCalc(); return; }
  if(k==='‚Üê'){ calcExpr = calcExpr.slice(0,-1); renderCalc(); return; }
  if(k==='='){ evaluateCalc(); return; }
  calcExpr += (k==='√ó'?'*':k==='√∑'?'/':k); renderCalc();
}
function renderCalc(){ calcDisplay.textContent = calcExpr || '0'; }
function evaluateCalc(){
  try{
    if(!/^[0-9+\-*/().\s]+$/.test(calcExpr)){ alert('Unsupported expression'); return; }
    const val = Function('"use strict";return ('+calcExpr+')')();
    calcExpr = String(val); renderCalc();
