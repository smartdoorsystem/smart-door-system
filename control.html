<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smart Door System â€” Control</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    :root {
      --bg1: #2c2c2c; --bg2: #1a1a1a;
      --card: #2f2f2f; --list: #3a3a3a; --list-hover: #4a4a4a; --text: #fff;
    }
    body {
      background: linear-gradient(120deg, var(--bg1), var(--bg2));
      color: var(--text);
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,"Plus Jakarta Sans",Arial,sans-serif;
    }
    h1 {
      text-align: center; font-weight: 800; letter-spacing: .05em;
      margin: 40px 0 24px;
    }
    .control-card {
      background: var(--card); border: 0; border-radius: 16px; overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, .15);
    }
    .list-group-item {
      background: var(--list); border: 0; color: var(--text);
      padding: 12px 20px; font-weight: 500;
    }
    .list-group-item:hover {
      background: var(--list-hover);
    }
  </style>
</head>

<body>
  <main class="container">
    <h1>Smart Door System ðŸšª</h1>

    <div class="row">
      <div class="col-12 col-md-8 mx-auto">
        <div class="row" style="display: none;" id="livestreamBox">
          <div class="col-12 col-md-8 mx-auto">
            <div class="card p-3 my-3">
              <h2>Live Stream</h2>
              <iframe
                src="https://player.twitch.tv/?channel=jq7v444&parent=https://smartdoorsystem.github.io/smart-door-system/control.html"
                height="480"
                width="100%"
                allowfullscreen="true">
              </iframe>
            </div>
          </div>
        </div>

        <div class="card control-card p-4">
          <h2 class="h4">Controls</h2>
          <div class="accordion accordion-flush mt-3" id="accordionFlushExample">
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne">
                  Camera & Stream
                </button>
              </h2>
              <div id="flush-collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                <ul class="list-group list-group-flush">
                  <li class="list-group-item" onclick="sendCommand('start camera');">Start Camera</li>
                  <li class="list-group-item" onclick="sendCommand('stop camera');">Stop Camera</li>
                  <li class="list-group-item" onclick="sendCommand('start_stream');">Start Stream</li>
                  <li class="list-group-item" onclick="sendCommand('stop_stream');">Stop Stream</li>
                </ul>
              </div>
            </div>

            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo">
                  Door
                </button>
              </h2>
              <div id="flush-collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                <ul class="list-group list-group-flush">
                  <li class="list-group-item" onclick="sendCommand('door_openn');">Open Door</li>
                  <li class="list-group-item" onclick="sendCommand('door_closee');">Close Door</li>
                </ul>
              </div>
            </div>

            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseThree">
                  System
                </button>
              </h2>
              <div id="flush-collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                <ul class="list-group list-group-flush">
                  <li class="list-group-item" onclick="sendCommand('sys_unloc');">Unlock</li>
                  <li class="list-group-item" onclick="sendCommand('sys_loc');">Lock</li>
                  <li class="list-group-item" onclick="sendCommand('sys_pen');">Permanent Unlock</li>
                  <li class="list-group-item" onclick="sendCommand('sys_pen30');">Permanent Unlock (30s)</li>
                  <li class="list-group-item" onclick="sendCommand('sys_pen60');">Permanent Unlock (60s)</li>
                  <li class="list-group-item" onclick="sendCommand('sys_buzzcof');">Buzz On Call for Help</li>
                  <li class="list-group-item" onclick="sendCommand('sys_buzzpoc');">Buzz On Person Coming</li>
                  <li class="list-group-item" onclick="sendCommand('sys_buzztok');">Buzz On Time Out Key</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC6wL_g_L_m0_j-z_n_o-x_c_m_d_f-g_h_j-k_l_p-q_r-s_t-u_v-w_x-y-z",
      authDomain: "smart-door-system-project.firebaseapp.com",
      databaseURL: "https://smart-door-system-project-default-rtdb.firebaseio.com",
      projectId: "smart-door-system-project",
      storageBucket: "smart-door-system-project.firebasestorage.app",
      messagingSenderId: "298920936811",
      appId: "1:298920936811:web:033b6b7af47d93d52f382e",
      measurementId: "G-HY1Y22VZJT"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    function sendCommand(command) {
      set(ref(db, "commands/last"), {
        action: command,
        timestamp: Date.now()
      });
      alert("âœ… Sent: " + command);

      if (command === "start_stream") {
        document.getElementById("livestreamBox").style.display = "block";
      } else if (command === "stop_stream") {
        document.getElementById("livestreamBox").style.display = "none";
      }
    }
    window.sendCommand = sendCommand;

    window.closeInnerMenus = function (parentId) {
      setTimeout(() => {
        let parent = document.querySelector(parentId);
        if (parent && parent.classList.contains("collapsed")) {
          // Do nothing, the menu is already collapsed
        } else if (parent) {
          // Programmatically click the button to collapse the menu
          parent.click();
        }
      }, 100);
    };
  </script>
</body>
</html>

