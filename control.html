<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Door System Control</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1c1c1c;
      color: white;
      text-align: center;
    }
    h1 {
      margin-top: 20px;
      color: cyan;
    }
    .button {
      display: inline-block;
      margin: 10px;
      padding: 12px 20px;
      border-radius: 10px;
      background: #333;
      color: white;
      cursor: pointer;
      transition: 0.2s;
    }
    .button:hover {
      background: #555;
    }
    video {
      margin-top: 20px;
      width: 640px;
      height: 360px;
      background: black;
      border: 2px solid white;
      border-radius: 10px;
    }
    .section {
      margin: 25px 0;
    }
  </style>
</head>
<body>
  <h1>Smart Door System Control</h1>

  <!-- ŸÇÿ≥ŸÖ ÿßŸÑÿ™ÿ≠ŸÉŸÖ -->
  <div class="section">
    <h2>‚öôÔ∏è Door & System Control</h2>
    <div class="button" onclick="sendAction('normal_door')">Open & Close Door</div>
    <div class="button" onclick="sendAction('door_openn')">Open Door Only</div>
    <div class="button" onclick="sendAction('door_closee')">Close Door Only</div>
    <div class="button" onclick="sendAction('sys_unloc')">Unlock System</div>
    <div class="button" onclick="sendAction('sys_loc')">Lock System</div>
    <div class="button" onclick="sendAction('sys_pen')">Penalty</div>
    <div class="button" onclick="sendAction('sys_pen30')">Penalty 30s</div>
    <div class="button" onclick="sendAction('sys_pen60')">Penalty 60s</div>
  </div>

  <!-- ŸÇÿ≥ŸÖ ÿßŸÑÿ®ÿ´ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ± -->
  <div class="section">
    <h2>üì° Live Stream</h2>
    <video id="liveVideo" autoplay playsinline></video>
    <div>
      <div class="button" onclick="startLiveStream()">Start Stream</div>
      <div class="button" onclick="stopLiveStream()">Stop Stream</div>
    </div>
  </div>

  <script>
    // === Firebase Config ===
    const firebaseConfig = {
      apiKey: "AIzaSyACQ7ot2G6wvmNRM_hmmTDK8p7zMBQ1w2c",
      authDomain: "smart-door-system-project.firebaseapp.com",
      databaseURL: "https://smart-door-system-project-default-rtdb.firebaseio.com",
      projectId: "smart-door-system-project",
      storageBucket: "smart-door-system-project.firebasestorage.app",
      messagingSenderId: "298920936811",
      appId: "1:298920936811:web:033b6b7af47d93d52f382e",
      measurementId: "G-HY1Y22VZJT"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // === ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ ===
    function sendAction(action) {
      db.ref("/control").set({ action: action });
      console.log("‚û°Ô∏è Sent:", action);
    }

    // === WebRTC ŸÑŸÑÿ®ÿ´ ===
    let pc = null;
    let liveVideo = document.getElementById('liveVideo');

    async function startLiveStream() {
      pc = new RTCPeerConnection();

      pc.ontrack = (event) => {
        liveVideo.srcObject = event.streams[0];
      };

      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);

      // ŸÜÿ®ÿπÿ´ ÿßŸÑŸÄ offer ŸÑŸÑŸÅÿßŸäÿ±ÿ®Ÿäÿ≥
      db.ref("/control").set({
        action: "webrtc_offer",
        sdp: offer.sdp
      });

      // ŸÜÿ≥ÿ™ŸÇÿ®ŸÑ ÿßŸÑŸÄ answer ŸÖŸÜ ÿßŸÑÿ®ÿßŸäÿ™ŸàŸÜ
      db.ref("/webrtc_answer").on("value", async (snapshot) => {
        const data = snapshot.val();
        if (data && data.sdp) {
          const answer = {
            type: "answer",
            sdp: data.sdp
          };
          await pc.setRemoteDescription(answer);
          console.log("‚úÖ Stream started");
        }
      });
    }

    function stopLiveStream() {
      if (pc) {
        pc.close();
        pc = null;
        liveVideo.srcObject = null;
        console.log("üõë Stream stopped");
      }
    }
  </script>
</body>
</html>
